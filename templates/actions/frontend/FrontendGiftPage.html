<!DOCTYPE html>
<html>
<head>
  <title>–ü–æ–¥–∞—Ä–æ–∫ –¥–ª—è –≤–∞—Å</title>
  <script src="{$wa_url}wa-content/js/jquery/jquery-3.6.0.min.js"></script>
  <style>
    .giftforyou-page {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    .button {
      background: #4CAF50;
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      margin: 20px 0;
    }
    .button:hover {
      background: #45a049;
    }
    .product-card {
      border: 2px solid #4CAF50;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      background: #f9f9f9;
    }
    .product-card img {
      max-width: 200px;
      height: auto;
      border-radius: 5px;
    }
    .price {
      font-size: 20px;
      font-weight: bold;
      color: #e74c3c;
    }
    .email-form {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 5px;
    }
    .email-form input[type="email"] {
      padding: 10px;
      width: 250px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }
    .error {
      color: #e74c3c;
      background: #ffeaa7;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .success {
      color: #27ae60;
      background: #d5f4e6;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
<div class="giftforyou-page">
  <h1>üéÅ –ü–æ–¥–∞—Ä–æ–∫ –¥–ª—è –≤–∞—Å!</h1>

  {if !empty($error)}
  <div class="error">{$error}</div>
  {/if}

  <div class="gift-section">
    <button id="get-gift-btn" class="button">üéØ –ö—Ä—É—Ç–∏—Ç—å!</button>
  </div>

  <div id="gift-result" style="display: none;">
    {if !empty($product)}
    <div class="product-card">
      <h2>üéâ –í–∞—à –ø–æ–¥–∞—Ä–æ–∫:</h2>
      {if $product.image_id}
      {* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤–æ–π—Å—Ç–≤–æ –≤–º–µ—Å—Ç–æ –º–µ—Ç–æ–¥–∞ *}
      <img src="{$product.image_url|default:''}" alt="{$product.name}" style="max-width: 200px;">
      {else}
      <div style="height: 150px; background: #eee; display: flex; align-items: center; justify-content: center;">
        üì∑ –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      </div>
      {/if}
      <h3>{$product.name}</h3>
      <p class="price">üí∞ –¶–µ–Ω–∞: {$product.price} —Ä—É–±.</p>
      <p><a href="{$product_url}" target="_blank">üîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä</a></p>

      <div class="email-form">
        <h4>üìß –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ email:</h4>
        <form id="email-form">
          <input type="hidden" name="product_id" value="{$product.id}">
          <input type="email" name="email" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email" required>
          <button type="submit" class="button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
      </div>
    </div>
    {/if}
  </div>

  <div id="success-message" class="success" style="display: none;">
    <p>‚úÖ –ü–∏—Å—å–º–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–¥–∞—Ä–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à email!</p>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#get-gift-btn').click(function() {
      $('#gift-result').show();
      $(this).hide();
    });

    $('#email-form').submit(function(e) {
      e.preventDefault();
      var form = $(this);
      var submitBtn = form.find('button[type="submit"]');

      submitBtn.prop('disabled', true).text('–û—Ç–ø—Ä–∞–≤–∫–∞...');

      console.log('Sending AJAX request to:', '{$wa_url}shop/giftforyou/send/');

      $.ajax({
        url: '{$wa_url}shop/giftforyou/send/',  // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π URL
        type: 'POST',
        data: form.serialize(),
        dataType: 'json',
        success: function(response) {
          console.log('Success:', response);
          if (response.success) {
            form.hide();
            $('#success-message').show();
          } else {
            alert('–û—à–∏–±–∫–∞: ' + response.error);
          }
        },
        error: function(xhr, status, error) {
          console.log('AJAX Error:', status, error);
          console.log('Response:', xhr.responseText);
          alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
        },
        complete: function() {
          submitBtn.prop('disabled', false).text('–û—Ç–ø—Ä–∞–≤–∏—Ç—å');
        }
      });
    });
  });
</script>
</body>
</html>